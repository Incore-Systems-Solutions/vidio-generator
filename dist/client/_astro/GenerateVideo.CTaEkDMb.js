import{j as e,B as x}from"./createLucideIcon.BWUjMJ0t.js";import{r as i}from"./index.RH_Wq4ov.js";import{C as P,a as A,b as M,c as R}from"./card.BkPeL54w.js";import{B as j}from"./badge.DE2H0mDD.js";import{v as N}from"./api.BgGK7ZEH.js";import{v as K}from"./videoSetupStorage.Fc38nvc3.js";import{R as d}from"./refresh-cw.CBIVstNO.js";import{C as z,a as H}from"./clock.C2OUqiaQ.js";import{A as O}from"./arrow-left.BkpbGPXl.js";import{V as g}from"./video.CTT0PdyH.js";import{E as q}from"./eye.BlDuAj9Y.js";import{D as J}from"./download.BNLMLlBi.js";import{F as Q}from"./file-text.BreevVoY.js";import{C as W}from"./circle-check-big.D_AmXthT.js";import{P as X}from"./play.CmT1PXqT.js";function ge({onBack:b}){const[n,D]=i.useState(null),[Y,E]=i.useState(null),[$,T]=i.useState(!0),[k,w]=i.useState(null),[p,y]=i.useState(!1),[F,h]=i.useState(300),[v,c]=i.useState(0),[r,m]=i.useState(1),[f,u]=i.useState(0),[o,S]=i.useState(null),I=async()=>{try{w(null);const s=localStorage.getItem("x-api-key");if(!s)throw new Error("API key tidak ditemukan. Silakan lakukan pembayaran terlebih dahulu.");const a=await N.generateVideo(s);if(a.status)if(D(a.data),a.data.status_video==="progress")v===0&&V();else if(a.data.status_video==="success"){if(a.data.task_id)try{const t=await N.checkVideoStatus(a.data.task_id);t.status&&t.data.status_video==="success"&&S(t.data)}catch(t){console.error("Error checking video status:",t)}c(100),h(0),m(5),u(100)}else a.data.status_video==="failed"&&(c(0),h(0),m(1),u(0));else throw new Error(a.message||"Failed to fetch video generation")}catch(s){w(s instanceof Error?s.message:"Failed to fetch video generation")}finally{T(!1),y(!1)}},C=async()=>{y(!0),await I()},V=()=>{c(0),m(1),u(0),h(300);const s=setInterval(()=>{h(l=>l<=1?(clearInterval(s),0):l-1)},1e3),a=setInterval(()=>{c(l=>l>=100?(clearInterval(a),100):l+.5)},1500),t=setInterval(()=>{m(l=>l>=5?(clearInterval(t),5):l+1)},6e4),_=setInterval(()=>{u(l=>l>=100?(clearInterval(_),100):l+1)},600);return()=>{clearInterval(s),clearInterval(a),clearInterval(t),clearInterval(_)}};i.useEffect(()=>{I();const s=K.load();E(s)},[]),i.useEffect(()=>{if(n?.status_video==="progress"){const s=V(),a=setTimeout(async()=>{if(n?.task_id)try{const t=await N.checkVideoStatus(n.task_id);t.status&&t.data.status_video==="success"&&(S(t.data),c(100),m(5),u(100))}catch(t){console.error("Error checking video status:",t)}});return()=>{s(),clearTimeout(a)}}},[n?.status_video]);const G=s=>{switch(s.toLowerCase()){case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"progress":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},L=s=>{switch(s.toLowerCase()){case"success":return"Video Berhasil Dihasilkan";case"progress":return"Sedang Dihasilkan";case"failed":return"Gagal Dihasilkan";default:return"Menunggu"}},U=s=>{const a=Math.floor(s/60),t=s%60;return`${a}:${t.toString().padStart(2,"0")}`},B=()=>[{id:1,title:"Memproses Pembayaran",description:"Verifikasi pembayaran dan mengaktifkan layanan",icon:e.jsx(W,{className:"w-5 h-5"}),status:"completed",color:"green",progress:100},{id:2,title:"Mempersiapkan Karakter AI",description:"Menganalisis dan memproses karakter yang dipilih",icon:r>=2?e.jsx(d,{className:"w-5 h-5 animate-spin"}):e.jsx(g,{className:"w-5 h-5"}),status:r>2?"completed":r===2?"in-progress":"waiting",color:r>2?"green":r===2?"purple":"gray",progress:r>2?100:r===2?f:0},{id:3,title:"Menyiapkan Environment",description:"Memproses background dan pengaturan lingkungan",icon:r>=3?e.jsx(d,{className:"w-5 h-5 animate-spin"}):e.jsx(g,{className:"w-5 h-5"}),status:r>3?"completed":r===3?"in-progress":"waiting",color:r>3?"green":r===3?"purple":"gray",progress:r>3?100:r===3?f:0},{id:4,title:"Menghasilkan Voice AI",description:"Membuat suara menggunakan AI",icon:r>=4?e.jsx(d,{className:"w-5 h-5 animate-spin"}):e.jsx(X,{className:"w-5 h-5"}),status:r>4?"completed":r===4?"in-progress":"waiting",color:r>4?"green":r===4?"purple":"gray",progress:r>4?100:r===4?f:0},{id:5,title:"Rendering Video Final",description:"Menggabungkan semua elemen menjadi video final",icon:r>=5?e.jsx(d,{className:"w-5 h-5 animate-spin"}):e.jsx(g,{className:"w-5 h-5"}),status:r>5?"completed":r===5?"in-progress":"waiting",color:r>5?"green":r===5?"purple":"gray",progress:r>5?100:r===5?f:0}];return $?e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Memuat progress generation..."})]})})}):k?e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Gagal Memuat Progress"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:k}),e.jsx(x,{onClick:C,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-4 h-4 mr-2 animate-spin"}),"Memuat..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"Coba Lagi"]})})]})})}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[b&&e.jsxs(x,{variant:"outline",size:"sm",onClick:b,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Kembali"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Progress Generation"}),e.jsx("p",{className:"text-muted-foreground",children:"Video AI sedang diproses"})]})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:C,disabled:p,children:[e.jsx(d,{className:`w-4 h-4 mr-2 ${p?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"mb-12",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Progress Generation"})}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Progress Keseluruhan"}),e.jsxs("span",{className:"text-sm font-bold text-foreground",children:[v,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 h-3 rounded-full transition-all duration-500",style:{width:`${v}%`}})})]}),n?.status_video==="progress"&&e.jsx("div",{className:"text-center mb-8",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-muted-foreground",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:["Tersisa ",U(F)]})]})})]})]}),e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Detail Proses"}),e.jsx("p",{className:"text-muted-foreground",children:"Proses pembuatan video AI sedang berlangsung"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"space-y-4",children:B().map(s=>e.jsx("div",{className:`p-6 border rounded-xl transition-all ${s.status==="completed"?"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800":s.status==="in-progress"?"bg-purple-50 dark:bg-purple-950/20 border-purple-200 dark:border-purple-800":"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.status==="completed"?"bg-green-100 dark:bg-green-900/30":s.status==="in-progress"?"bg-purple-100 dark:bg-purple-900/30":"bg-gray-100 dark:bg-gray-800"}`,children:e.jsx("div",{className:s.status==="completed"?"text-green-600 dark:text-green-400":s.status==="in-progress"?"text-purple-600 dark:text-purple-400":"text-gray-600 dark:text-gray-400",children:s.icon})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${s.status==="completed"?"text-green-800 dark:text-green-200":s.status==="in-progress"?"text-purple-800 dark:text-purple-200":"text-foreground"}`,children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.status==="in-progress"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${s.progress}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(s.progress),"% selesai"]})]})]})]}),e.jsx(j,{className:s.status==="completed"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":s.status==="in-progress"?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",children:s.status==="completed"?"Selesai":s.status==="in-progress"?"Sedang Proses":"Menunggu"})]})},s.id))})})]}),(n?.status_video==="success"||o?.status_video==="success")&&e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Video Hasil"}),e.jsx("p",{className:"text-muted-foreground",children:"Video AI Anda telah selesai diproses"})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-5 h-5"}),e.jsx("span",{children:"Video AI Siap"})]})}),e.jsx(R,{children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-full h-64 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Video preview akan muncul di sini"})]})}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs(x,{onClick:()=>{o?.resultUrl&&(window.location.href=`/download?url=${encodeURIComponent(o.resultUrl)}&taskId=${o.task_id}`)},children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Lihat Video"]}),e.jsxs(x,{variant:"outline",onClick:()=>{o?.resultUrl&&(window.location.href=`/download?url=${encodeURIComponent(o.resultUrl)}&taskId=${o.task_id}`)},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Download"]})]})]})})]})})]}),n&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-5 h-5"}),e.jsx("span",{children:"Detail Video"})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Task ID"}),e.jsx("p",{className:"font-medium text-foreground",children:n.task_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Model AI"}),e.jsx(j,{variant:"outline",children:n.model_ai})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aspect Ratio"}),e.jsx(j,{variant:"outline",children:n.aspect_ratio})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(j,{className:G(n.status_video),children:L(n.status_video)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Prompt"}),e.jsx("p",{className:"text-sm text-foreground bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:n.prompt})]})]})]})})]})}export{ge as GenerateVideo};
